<!DOCTYPE html>
<html>
  <head>
    <title>menufy</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= favicon_link_tag 'favicon.ico' %>
    <%= stylesheet_link_tag "tailwind", "inter-font", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <script src="https://kit.fontawesome.com/bfa19ffe9b.js" crossorigin="anonymous"></script>
  </head>

  <% skip_navbar = params[:controller] == 'restaurants' && params[:action] == 'show' || params[:controller] == 'sub_restaurants' && params[:action] == 'show' || params[:controller] == 'layouts' && params[:action] == 'show' %>

  <body class="bg-gray-50">
   <% unless skip_navbar %>
      <%= user_signed_in? ? render('layouts/sidebar') : render('layouts/navbar') %>
    <% end %>
    <main class="<%= user_signed_in? && !skip_navbar ? 'relative lg:pl-56 pt-4 ' : 'sm:pt-16 pt-4' %>">
      <% unless flash.empty? %>
        <div id="flash" class="text-white sm:pl-20 absolute top-0 right-0 z-50 w-[50%]shadow-lg rounded">
          <% flash.keys.each do |k| %>
            <div class="sm:px-20 px-8 py-9 flex justify-center items-center gap-4 border-l-8 text-sm relative <%= notification_class(k) %>">
              <div id="progress-bar" class="h-1 absolute top-0 left-0 <%= progress_bar_background(k) %>">
              </div>
              <i class="<%= notification_icon(k) %> text-xl"></i>
              <%= flash[k] %>
              <div class="cursor-pointer" onclick="document.getElementById('flash').classList.add('hidden')">
                <i class="fa-solid fa-square-xmark text-xl"></i>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
      <%= yield %>
    </main>

    <script>
      document.addEventListener('turbo:load', () => {
        const flash = document.getElementById('flash');
        const progressBar = document.getElementById('progress-bar');
        let progress = 100;
        let intervalId;

        if (flash) {
          intervalId = setInterval(() => {
            progress -= 1;
            progressBar.style.width = `${progress}%`;

            if (progress <= 0) {
              clearInterval(intervalId);
              flash.classList.add('hidden');
            }
          }, 50);
        }
      });

      function closeFlash() {
        const flash = document.getElementById('flash');
        if (flash) {
          clearInterval(intervalId);
          flash.classList.add('hidden');
        }
      }
    </script>
  </body>
</html>